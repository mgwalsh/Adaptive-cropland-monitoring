# Field surveys and physical sample collections {#field-surveys}

*Edited by: Markus Walsh, Barbara Walsh, Jordan Chamberlin, ... ?*

## Introduction {#fs-intro}

This chapter illustrates procedures for organizing and conducting field surveys and for collecting physical samples. This is the practical, field-based side-of-things, which provides field observations and the physical measurements of any (physical) rock, water, soil, plant and potentially livestock fecal (and/or blood) samples, which can be georeferenced, measured and databased in a consistent manner. 

Field survey activities are fairly expensive to implement, but they also have particulary high information value for any subsequent analyses and cropland management decisions. So, it is very important to plan and execute the associated field activities carefully. We can think of field surveys, monitoring and experiments as occurring in 6 sequential and interdependent steps:

1. Delineation of a geographical Region of Interest (RoI).
1. Drawing up a spatially representative sample of locations from within the ROI, considering any potential field crew safety factors ... first-and-foremost.
1. Setting up of standard field observation, measurement and/or experimental protocols that work digitally with e.g. [KoboToolbox](https://qed.ai/kt/).
1. Conducting the field sampling and collecting the needed georeferenced observations, physical samples and/or monitoring data.
1. Sample processing and curation.
1. Finally, consitently repeat and update the previous 5 steps over time.

The associated activities have to be carried out in sequence. But, the actual procedures can certainly be changed as different survey or monitoring priorities emerge over time. This chapter covers the 6 steps including example data, R-code and the relevant links to external open-source resources.

## Delineating a region of interest {#roi}

This section describes setting up a field sampling plan that provides representative spatial coverage over any given landscape or *"Region of Interest"* (RoI). Selecting an ROI for ground sampling is a critical step, because it determines both the main and recurrent costs of any adaptive monitoring program as well as the resulting precision and accuracy of inferences and predictions that are made about that ROI. A geograhically consistent field sampling frame should therefore always be defined in terms of the objectives, and constraints of the mapping and monitoring tasks at hand. 

The following provides an example that is based on the need for physically sampling representative cropland areas in all of Tanzania. The ROI calculations for this example are shown in the chunk below, which encompasses the national area of Tanzania in which cropland is predicted to occur (in 2020). The set up, packages and data needed for this exercise are also found below. Note that both cropland and building occurrences are based on comprehensive GeoSurveys, which were conducted in 2017-2018 (see chapter ...). You'll need the following R-packages:

```{r}
suppressPackageStartupMessages({
  require(downloader)
  require(rgdal)
  require(raster)
  require(BalancedSampling)
  require(leaflet)
  require(htmlwidgets)
})
```

The data for running the Tanzania example is available via:

```{r}
# Data setup --------------------------------------------------------------
# download & stack cropland probability/mask & distance to "major roads" grids
download("https://www.dropbox.com/s/83qwr9stamkrqfi/TZ_sample_grids.zip?raw=1", "TZ_sample_grids.zip", mode="wb")
unzip("TZ_sample_grids.zip", overwrite=T)
glist <- list.files(pattern="tif", full.names=T)
grids <- stack(glist)

# download GADM-L3 shapefile (courtesy: http://www.gadm.org)
download("https://www.dropbox.com/s/bhefsc8u120uqwp/TZA_adm3.zip?raw=1", "TZA_adm3.zip", mode="wb")
unzip("TZA_adm3.zip", overwrite=T)
shape <- shapefile("TZA_adm3.shp")
```

## Drawing up a sampling plan {#samp-plan}

Next is the sample frame setup and a working definition of the region of interest (ROI). Note that apart from the (GeoSurvey) cropland area mask for Tanzania, we have also included a *"distance to building"* covariate. By neccessity, cropping activities are closely associated with the presence of buildings and humans. From a practical perspective this is also included because of the typically extreme logistics and potential hazards to field crews associated with collecting samples in Tanzania. However, one can always change the `bdt` (distance to building) variable in the script chunk to accommodate any other specific sampling frame coverage requirements. One could also use additional constraint variables where needed.

```{r}
# Sample setup ------------------------------------------------------------
# create a ROI image based on cropland mask and distance to nearest main roads
cp <- 1    ## set cropland mask to 1
bd <- 2.5  ## set maximum distance to the nearest "building" (in km)
roi <- overlay(grids, fun=function(x) 
{return(ifelse(x[1] >= cp && x[2] > 0 && x[2] <= bd, 1, 0))})

# extract ROI coordinates
coord <- coordinates(roi)
index <- extract(roi, coord)
index <- as.data.frame(cbind(coord, index))
rmask <- index[which(index$index == 1),]
```

This provides a plot of the ROI, and extracts the needed spatial coordinates of the intended sampling frame. The ROI can be plotted as a R raster object:

```{r}
plot(roi, axes=F, legend=F)
```

The following chunk then performs the steps of drawing a spatially balanced sample from the specified ROI. We use the `lcube` package from the `BalancedSampling` library in R (R Core Team, 2017) to draw a representative sample here. The method implements the cube method of Deville and Tillé (2004), which allows one to sample based on the relevant inclusion probabilities while aiming for balance and spread with respect to speciﬁed covariates and/or constraints. 

In this particular case potential sample sites were selected for spatial balance, which entails that the mean coordinates of sample sites are close to the mean coordinates of all points in the sample frame and have adequate spatial spread (which ensures that the observations are spread out rather than clustered with respect to spatial coordinates), see Grafström and Schelin (2014). The following chunk performs those calculations:

```{r}
# Geographically balanced sampling ----------------------------------------
# set sampling parameters
N <- nrow(rmask) ## population size (in 250 m pixels)
n <- round(N/16*0.1,0) ## set sample size (number of proposed sampling locations)
p <- rep(n/N,N)  ## calculates the inclusion probabilities

# draw geographically balanced sample
set.seed(6405)                      ## sets repeatable randomization seed
B <- cbind(p, rmask[,1], rmask[,2]) ## specifies balancing variables
rsamp <- cube(p, B)                 ## samples from the ROI/population using the cube method
```

The sampling coordinates can also be exported as a GPS readable file, which allows survey crews to navigate to the planned locations in the field. It can also be plotted as a zoomable map using the `leaflet` package.

```{r}
# Write files -------------------------------------------------------------
# extract sample coordinates
x <- rmask[rsamp,1]
y <- rmask[rsamp,2]
xy <- data.frame(cbind(x,y))

# attach GADM-L3 and above unit names from shape
coordinates(xy) <- ~x+y
crs(xy) <- "+proj=laea +ellps=WGS84 +lon_0=20 +lat_0=5 +units=m +no_defs"
sloc <- spTransform(xy, CRS(proj4string(shape)))
gadm <- sloc %over% shape
sloc <- as.data.frame(sloc)
samp <- cbind(gadm[ ,c(5,7,9)], sloc)
colnames(samp) <- c("region", "district", "ward", "lon", "lat")
write.csv(samp, "TZ_fsamp.csv", row.names = F)

# Sampling map widget -----------------------------------------------------
# render map
w <- leaflet() %>% 
  addProviderTiles(providers$OpenStreetMap.Mapnik) %>%
  addCircleMarkers(samp$Lon, samp$Lat, clusterOptions = markerClusterOptions())
w ## plot widget 

# save widget
saveWidget(w, 'TZ_sample.html', selfcontained = T)
```

## Setting up of standard field observation and measurement protocols {#om-protocols}

Note that most field survey crews will need to be trained in GPS navigation prior to departing for surveys. However, the training can be usually be in a single day for multiple crews.

You shall need the following equipment and materials:

1. An Android phone or tablet.
1. A separate GPS device (optional, but is highly recommended for field navigation).
1. A soil auger marked with colored tape at 20 and 50 cm from the tip.
1. 2, 20-liter plastic buckets.
1. A 5-liter plastic jerry can for water.
1. A rope marked with colored tape at 2.82, 4.61 and 5.64 meters.
1. Sturdy, ~2-3 liter plastic/or paper bags, 2 bags for each soil sample.
1. Sticky QR code sample labels, 2 for each soil sample.

Before you go into the field:

*	Install ODK forms. To use the ODK soil sample login form you initially need to install the following applications on your Android device (phone or tablet):
* ODK Collect (to georeference, time stamp, and log in your soil sample)
* XZing barcode scanner (to read QR code labels)
* GPS Essentials (if you are going to be using your phone or tablet for field navigation rather than a separate GPS unit).

You can locate the applications on Google Play by searching for them by name. Note that you will need an Internet connection for this. Once you have installed the software on your Android device: start ODK Collect and then set the server address that will link you to the “Soil sample” form:
General Settings > Configure platform > URL. The General Settings menu can be accessed by tapping the <left> menu button on your device. 

* Don’t worry about entering a Username or Password. They are not needed.
* Set the URL field to: http://??.

This allows you to download blank forms for use on your Android device. It also allows you to save any completed forms to a database on the server. To download the blank ODK Soil sample form to your device, follow these 3 steps:
